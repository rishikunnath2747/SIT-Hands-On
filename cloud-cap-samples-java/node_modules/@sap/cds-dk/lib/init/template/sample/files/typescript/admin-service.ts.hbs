import cds from '@sap/cds'

import { Books } from '#cds-models/AdminService'

export class AdminService extends cds.ApplicationService { async init() {

  /**
   * Generate primary keys for target entity in request
   */
  this.before ('NEW', Books.drafts, async req => {
    if (req.data.ID) return
    const { ID } = await SELECT.one.from(Books).columns('max(ID) as ID') ?? { ID: 0 }
    req.data.ID = ID! - ID! % 100 + 100 + 1
  })
  return super.init()
}}